% !TEX root=../main.tex

\section{Performing tasks one after the other}

In the previous section we have set up our interaction model of events and actions,
and we defined our first interactive component, the editor.
Now that we have the core part of an interactive workflow,
we can continue with the composition of tasks.
Composing tasks can be done in two ways:
\begin{enumerate*}
  \item sequential or
  \item parallel.
\end{enumerate*}
For parallel composition we distinguish two kinds:
\begin{enumerate*}[(a)]
  \item pairing two tasks (\emph{and}-parallel); and
  \item choosing between two tasks (\emph{or}-parallel).
\end{enumerate*}
In this section we start with sequential composition.
The next two sections are about pairing and choosing.

One might think that the best way to sequence two tasks is by using a combinator taking two tasks:
the current one and the continuation.
However, we like the continuation to be parametrised.
The \emph{step} from one task to another is \emph{a calculation which provides the next task to proceed with}.
Therefore, we take the continuation to be a \emph{function}.
Don't worry, it is just a normal function from our host language which,
when evaluated, results in something of type $\Task$.
Syntactically this leads to
\begin{grammar}
  Pretasks
    & p & ::=& \ldots        & \\
    &   &\mid& e_1 \Then e_2 & – sequence \\
  Tasks
    & t & ::=& \ldots        & \\
    &   &\mid& t_1 \Then e_2 & – sequence \\
\end{grammar}
And the accompanied typing rule looks like
\begin{equation*}
  \userule{T-Then}
\end{equation*}

\begin{margintext}{Aside: Steps and the step combinator}
Again a side note for the iTasks guru.
In this section we introduced a way to step from one task to another.
How does this compare to the step combinators found in the iTasks framework?
Which combinator does $\Then$ correspond to?
We have multiple options: \type{(>>*)}, \type{(>>=)}, \type{(>>-)}, \type{(>>\~)}, \type{(>>|)}.
\end{margintext}


\subsection{Normalisation}

We can think of normalisation as a \enquote{medium step} semantics,
evaluation tasks $t$ as much as possible,
till the moment we need an event to continue.

\begin{equation*}
  \userule{N-Then} \qquad \userule{N-ThenEval}
\end{equation*}

\subsection{Handling}

\begin{equation*}
  \begin{array}{lcl}
    \multicolumn{3}{l}{\Observe : t \to v^?} \\
    \Observe(\Edit v) &=& v \\
    \Observe(\_)      &=& \nothing
  \end{array}
\end{equation*}

\begin{grammar}
  Actions
    & \alpha & ::=& \ldots & \\
    &        &\mid& \Next  & – continue with next task \\
\end{grammar}

\begin{equation*}
  \userule{H-Next} \qquad \userule{H-Stay}
\end{equation*}
\begin{equation*}
  \userule{H-PassS}
\end{equation*}

\subsection{Example}
