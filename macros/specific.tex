% !TEX root=../main.tex


%% Helpers %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%NOTE: `\mathrel` gives a single space width between keywords but removes it after another relational operator.
%%      `\mathop`  gives just a small skip, but doesn't has above bug.
\newmacro{newoperator}[1]
  {\newmathcommand{#1}[op]}
%%FIXME: fix default argument
\newmacro{newkeyword}[2][1]
  {\newoperator{#1}{\text{\sffamily\bfseries #2}}}
\newmacro{newvalue}[2][1]
  {\newoperator{#1}{\text{\sffamily #2}}}
\newmacro{newtype}[2][1]
  {\newoperator{#1}{\text{\sffamily\scshape #2}}}


%% Host language %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newkeyword[IF]  {if}
\newkeyword[THEN]{then}
\newkeyword[ELSE]{else}

\newkeyword[Ref] {ref}

\newmacro{If}[3]
  {\IF #1 \THEN #2 \ELSE #3}


%% Values %%

\newvalue[True]{True}
\newvalue[False]{False}

\newmacro{astring}[1]
  {\text{``#1''}}


%% Types %%

\newtype[Unit]     {Unit}
\newtype[Bool]     {Bool}
\newtype[Int]      {Int}
\newtype[String]   {String}
\newtype[Reference]{Ref}
\newtype[Task]     {Task}


%% Object language %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\And\relax
\newoperator{Done} {\checkmark}
\newoperator{Then} {\vartriangleright}
\newoperator{When} {\blacktriangleright}
\newoperator{And}  {\otimes}
\newoperator{Or}   {\oplus}
\newoperator{Edit} {\square}
\newoperator{Empty}{\boxtimes}
\newoperator{Watch}{\blacksquare}
\newoperator{Fail} {\lightning}

\newoperator{Both} {\odot}


%% Events %%

\newvalue[Left]   {L}
\newvalue[Right]  {R}

\newvalue[Clear]  {C}
\newvalue[Next]   {N}
\newvalue[Pick]   {P}
\newvalue[Execute]{E}

\newvalue[First]  {F}
\newvalue[Second] {S}
\newvalue[Other]  {S}


%% Semantic functions %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newmathcommand{downto}[rel]
  {\Downarrow}
\newmathcommand{normalise}[rel]
  {\;\rightarrow\!\shortmid\;}
\newmacro{handle}[1]
  {\mathrel{\;\xrightarrow{\;#1\;}\;}}

\newmathcommand{Value}[cal]
  {V}
