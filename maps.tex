% !TEX root=pldi2019.tex


%% Language %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newmacro{O-Value}{
  \begin{flalign*}
    \begin{array}{lcl}
      \multicolumn{3}{l}{\Value : \mathrm{Tasks} \rightharpoonup \mathrm{Values}} \\
      \Value(\Edit v, s)       &=& v \\
      \Value(\Enter \tau, s)   &=& \bot \\
      \Value(\Update l, s)  &=& s(l) \\
      \Value(\Fail, s)         &=& \bot \\
      \Value(t_1 \Then e_2, s) &=& \bot \\
      \Value(t_1 \Next e_2, s) &=& \bot \\
      \Value(t_1 \And t_2, s)  &=& \left\{
        \begin{array}{ll}
          \tuple{v_1, v_2}  & \when\ \Value(t_1, s) = v_1 \land \Value(t_2, s) = v_2 \\
          \bot              & \otherwise
        \end{array}
      \right. \\
      \Value(t_1 \Or t_2, s)   &=& \left\{
        \begin{array}{ll}
          v_1               & \when\ \Value(t_1, s) = v_1 \\
          v_2               & \when\ \Value(t_1, s) = \bot \land \Value(t_2, s) = v_2 \\
          \bot              & \otherwise
        \end{array}
      \right. \\
      \Value(t_1 \Xor t_2, s)  &=& \bot\\
      \Value(u \At t, s)  &=& \Value(t,s)
    \end{array} & &&
  \end{flalign*}
}

\newmacro{O-Inputs}{
  \begin{flalign*}
    \begin{array}{lcl}
      \multicolumn{3}{l}{\Inputs : \mathrm{Tasks} \to \powerset(\mathrm{Inputs})} \\
      \Inputs(\Edit v:\Task\tau)       &=& \set{v':\tau, \Empty} \\
      \Inputs(\Enter \tau)   &=& \set{v':\tau} \\
      \Inputs(\Update l:\Task\tau)     &=& \set{v':\tau} \\
      \Inputs(\Fail)         &=& \set{} \\
      \Inputs(t_1 \Then e_2) &=& \Inputs(t_1) \\
      \Inputs(t_1 \Next e_2) &=& \Inputs(t_1) \cup \set{\Continue\mid \Value{(t_1)}\neq \bot \wedge \neg\Failing{(e_2 \Value{(t_1)}\stride)}} \\
      \Inputs(t_1 \And t_2)  &=& \set{\First\ i \mid i \in \Inputs(t_1)} \cup \set{\Second\ i \mid i \in \Inputs(t_2)} \\
      \Inputs(t_1 \Or t_2)   &=& \set{\First\ i \mid i \in \Inputs(t_1)} \cup \set{\Second\ i \mid i \in \Inputs(t_2)} \\
      \Inputs(e_1 \Xor e_2)  &=& \set{\Left, \Right} \\
      \Inputs(u_1 \At t)       &=& \set{u_2 \At i\mid u_2 \At i \in \Inputs(t)} \cup \set{u_1 \At i\mid i\in \Inputs(t)}
    \end{array} & &&
  \end{flalign*}
}

\newmacro{O-Failing}{
  \begin{flalign*}
    \begin{array}{lcl}
      \multicolumn{3}{l}{\Failing : \mathrm{Tasks} \to \mathrm{Booleans}} \\
      \Failing(\Edit v,s)       &=& \False \\
      \Failing(\Enter \tau,s)   &=& \False \\
      \Failing(\Update l,s)     &=& \False \\
      \Failing(\Fail,s)         &=& \True \\
      \Failing(t_1 \Then e_2,s) &=& \Failing(t_1,s) \\
      \Failing(t_1 \Next e_2,s) &=& \Failing(t_1,s) \\
      \Failing(t_1 \And t_2,s)  &=& \Failing(t_1,s) \wedge \Failing(t_2,s) \\
      \Failing(t_1 \Or t_2,s)   &=& \Failing(t_1,s) \wedge \Failing(t_2,s) \\
      \Failing(e_1 \Xor e_2,s)  &=& \Failing(t_1,s') \wedge \Failing(t_2,s') \mid e_1,s\stride t_1,s' \quad e_2,s\stride t_2,s'\\
      \Failing(u \At t,s)         &=& \Failing(t,s)
    \end{array} & &&
  \end{flalign*}
}
